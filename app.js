// –î–∞–Ω–Ω—ã–µ —ç—Ç–∞–ø–æ–≤ (–ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è)
const stages = {
    1: {
        title: "üçé –≠–¢–ê–ü 1: –ó–ê–†–ê–ñ–ï–ù–ò–ï",
        description: "–ë–µ–∑—É–º–Ω—ã–π —É—á–µ–Ω—ã–π –ê–≥—Ä–∏—É—Å –ø—Ä–æ–≤–µ–ª –Ω–µ—É–¥–∞—á–Ω—ã–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç! –í—Å–µ –∂–∏–≤–æ—Ç–Ω—ã–µ –Ω–∞ —Ñ–µ—Ä–º–µ —Å—Ç–∞–ª–∏ –∑–æ–º–±–∏. –ù–∞–π–¥–∏—Ç–µ –∑–∞—Ä–∞–∂–µ–Ω–Ω–æ–µ —è–±–ª–æ–∫–æ —Å –∫–æ–¥–æ–º.",
        task: "–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –Ω–∞ –≤—Ö–æ–¥–µ –∏ –Ω–∞–π–¥–∏—Ç–µ —è–±–ª–æ–∫–æ —Å –∫–æ–¥–æ–º",
        hint: "–ö–æ–¥ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–æ–≤–∞ –∏ –≥–æ–¥–∞ —á–µ—Ä–µ–∑ –Ω–∏–∂–Ω–µ–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ",
        fact: "–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç: –ü–µ—Ä–≤—ã–µ —Ñ–µ—Ä–º—ã –ø–æ—è–≤–∏–ª–∏—Å—å –æ–∫–æ–ª–æ 12 000 –ª–µ—Ç –Ω–∞–∑–∞–¥!",
        answer: "–ó–ê–†–ê–ñ–ï–ù–ò–ï_2024",
        points: 100
    },
    2: {
        title: "ü•ö –≠–¢–ê–ü 2: –¢–ê–ô–ù–ê –ó–û–ú–ë–ò-–Ø–ò–¶",
        description: "–ó–æ–º–±–∏-–∫—É—Ä—ã —Å–Ω–µ—Å–ª–∏ —è–π—Ü–∞ —Å–æ —Å—Ç—Ä–∞–Ω–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏! –ù–∞–π–¥–∏—Ç–µ –≤—Å–µ —è–π—Ü–∞ –∏ —Ä–∞—Å—à–∏—Ñ—Ä—É–π—Ç–µ –∫–æ–¥.",
        task: "–ù–∞–π–¥–∏—Ç–µ 5 —è–∏—Ü —Å —Å–∏–º–≤–æ–ª–∞–º–∏ –≤ –∫—É—Ä—è—Ç–Ω–∏–∫–µ",
        hint: "–°–∏–º–≤–æ–ª—ã: Œ© ‚Ä† ‚àû ¬§ ¬ß (–≤–≤–µ–¥–∏—Ç–µ –∏—Ö –ø–æ–¥—Ä—è–¥)",
        fact: "–ö—É—Ä—ã –º–æ–≥—É—Ç –∑–∞–ø–æ–º–Ω–∏—Ç—å –¥–æ 100 —Ä–∞–∑–Ω—ã—Ö –ª–∏—Ü!",
        answer: "Œ©‚Ä†‚àû¬§¬ß",
        points: 150
    },
    3: {
        title: "ü¶¢ –≠–¢–ê–ü 3: –ì–£–°–ò–ù–û–ï –°–ï–õ–§–ò",
        description: "–ü—Ä–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é –≥—É—Å–µ–π-–æ—Ö—Ä–∞–Ω–Ω–∏–∫–æ–≤ –∏ —Å–¥–µ–ª–∞–π—Ç–µ –∫—Ä—É—Ç–æ–µ —Å–µ–ª—Ñ–∏!",
        task: "–°–¥–µ–ª–∞–π—Ç–µ —Å–µ–ª—Ñ–∏ —Å –≥—É—Å—è–º–∏ –∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö",
        hint: "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ö—ç—à—Ç–µ–≥ #–ó–æ–º–±–∏–§–µ—Ä–º–∞2024",
        fact: "–ì—É—Å–∏ –æ–±—Ä–∞–∑—É—é—Ç –ø–∞—Ä—ã –Ω–∞ –≤—Å—é –∂–∏–∑–Ω—å!",
        answer: "–ì–£–°–ò_–û–•–†–ê–ù–ù–ò–ö–ò",
        points: 200
    },
    4: {
        title: "ü¶ô –≠–¢–ê–ü 4: –¢–ê–ô–ù–ê –õ–ê–ú–´",
        description: "–õ–∞–º–∞ –Ω–∞ —Ñ–µ—Ä–º–µ –∑–Ω–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç! –ù–æ –æ–Ω–∞ –≥–æ–≤–æ—Ä–∏—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —è–∑—ã–∫–µ –∂–µ—Å—Ç–æ–≤.",
        task: "–†–∞—Å—à–∏—Ñ—Ä—É–π—Ç–µ –∂–µ—Å—Ç—ã –ª–∞–º—ã –∏ –Ω–∞–π–¥–∏—Ç–µ –∫–æ–¥",
        hint: "–ö–æ–¥: 4 —Ü–∏—Ñ—Ä—ã (–≥–æ–¥ –æ—Å–Ω–æ–≤–∞–Ω–∏—è —Ñ–µ—Ä–º—ã)",
        fact: "–õ–∞–º—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ —Å—Ç–æ—Ä–æ–∂–µ–≤—ã–µ –∂–∏–≤–æ—Ç–Ω—ã–µ –¥–ª—è –æ—Ö—Ä–∞–Ω—ã –æ–≤–µ—Ü!",
        answer: "1998",
        points: 250
    },
    5: {
        title: "ü¶ò –≠–¢–ê–ü 5: –ü–†–´–ì–ê–Æ–©–ò–ô –ö–ï–ù–ì–£–†–£",
        description: "–ö–µ–Ω–≥—É—Ä—É-–∑–æ–º–±–∏ –ø—Ä—ã–≥–∞–µ—Ç –ø–æ —Ñ–µ—Ä–º–µ –∏ –æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—ã! –ü—Ä–æ—Å–ª–µ–¥–∏—Ç–µ –∑–∞ –Ω–∏–º.",
        task: "–ù–∞–π–¥–∏—Ç–µ –≤—Å–µ –º–µ—Å—Ç–∞, –≥–¥–µ –ø—Ä—ã–≥–∞–ª –∫–µ–Ω–≥—É—Ä—É",
        hint: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä—ã–∂–∫–æ–≤ = –∫–æ–¥",
        fact: "–ö–µ–Ω–≥—É—Ä—É –Ω–µ –º–æ–≥—É—Ç –¥–≤–∏–≥–∞—Ç—å –∑–∞–¥–Ω–∏–º–∏ –ª–∞–ø–∞–º–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞!",
        answer: "7",
        points: 300
    },
    6: {
        title: "üêÑ –≠–¢–ê–ü 6: –ú–û–õ–û–ö–û –ó–û–ú–ë–ò",
        description: "–ö–æ—Ä–æ–≤—ã –¥–∞—é—Ç –∑–∞—Ä–∞–∂–µ–Ω–Ω–æ–µ –º–æ–ª–æ–∫–æ! –ù–∞–π–¥–∏—Ç–µ –∞–Ω—Ç–∏–¥–æ—Ç –≤ –º–æ–ª–æ—á–Ω–æ–º —Ü–µ—Ö—É.",
        task: "–†–µ—à–∏—Ç–µ –≥–æ–ª–æ–≤–æ–ª–æ–º–∫—É —Å –±—É—Ç—ã–ª–∫–∞–º–∏ –º–æ–ª–æ–∫–∞",
        hint: "–ö–æ–¥: —Ü–≤–µ—Ç –±—É—Ç—ã–ª–∫–∏ + –Ω–æ–º–µ—Ä",
        fact: "–ö–æ—Ä–æ–≤–∞ –º–æ–∂–µ—Ç —É–∑–Ω–∞—Ç—å –¥–æ 50 –¥—Ä—É–≥–∏—Ö –∫–æ—Ä–æ–≤!",
        answer: "–ó–ï–õ–ï–ù–´–ô7",
        points: 350
    },
    7: {
        title: "üêë –≠–¢–ê–ü 7: –û–í–ï–ß–¨–Ø –®–ï–†–°–¢–¨",
        description: "–û–≤—Ü—ã —Å—Ç–∞–ª–∏ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º–∏! –£—Å–ø–æ–∫–æ–π—Ç–µ –∏—Ö, –Ω–∞–π–¥—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥.",
        task: "–ü–æ—Å—á–∏—Ç–∞–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ–ª—ã—Ö –∏ —á–µ—Ä–Ω—ã—Ö –æ–≤–µ—Ü",
        hint: "–ö–æ–¥: –±–µ–ª—ã–µ_—á–µ—Ä–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 12_8)",
        fact: "–û–≤—Ü—ã –∏–º–µ—é—Ç –ø–æ–ª–µ –∑—Ä–µ–Ω–∏—è 270 –≥—Ä–∞–¥—É—Å–æ–≤!",
        answer: "15_10",
        points: 400
    },
    8: {
        title: "üì± –≠–¢–ê–ü 8: –¢–ï–•–ù–û–õ–û–ì–ò–ò",
        description: "–ù–∞–π–¥–∏—Ç–µ –ø–ª–∞–Ω—à–µ—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞! –í–∑–ª–æ–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å.",
        task: "–†–µ—à–∏—Ç–µ —Ü–∏—Ñ—Ä–æ–≤—É—é –≥–æ–ª–æ–≤–æ–ª–æ–º–∫—É",
        hint: "–ü–∞—Ä–æ–ª—å: –¥–∞—Ç–∞ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ (–¥–¥.–º–º.–≥–≥–≥–≥)",
        fact: "–ü–µ—Ä–≤—ã–µ —Å–º–∞—Ä—Ç—Ñ–æ–Ω—ã –ø–æ—è–≤–∏–ª–∏—Å—å –≤ 1992 –≥–æ–¥—É!",
        answer: "15.03.2024",
        points: 450
    },
    9: {
        title: "üß© –≠–¢–ê–ü 9: –ü–ê–ó–õ –õ–ê–ë–û–†–ê–¢–û–†–ò–ò",
        description: "–°–æ–±–µ—Ä–∏—Ç–µ –ø–∞–∑–ª —Å –ø–ª–∞–Ω–æ–º –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏! –ù–∞–π–¥–∏—Ç–µ —Å–∫—Ä—ã—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.",
        task: "–°–æ–±–µ—Ä–∏—Ç–µ –ø–∞–∑–ª –∏–∑ 12 —á–∞—Å—Ç–µ–π",
        hint: "–ö–æ–¥: –ø–µ—Ä–≤—ã–µ –±—É–∫–≤—ã —Å–ª–æ–≤ –Ω–∞ –ø–∞–∑–ª–µ",
        fact: "–°–∞–º—ã–π –±–æ–ª—å—à–æ–π –ø–∞–∑–ª –≤ –º–∏—Ä–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 551,232 –¥–µ—Ç–∞–ª–µ–π!",
        answer: "–°–ü–ê–°–ò–¢–ï–§–ï–†–ú–£",
        points: 500
    },
    10: {
        title: "üî¶ –≠–¢–ê–ü 10: –ù–û–ß–ù–ê–Ø –û–•–û–¢–ê",
        description: "–ù–æ—á—å—é –∑–æ–º–±–∏-–∂–∏–≤–æ—Ç–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–µ–µ! –ù–∞–π–¥–∏—Ç–µ –∏—Ö —Å —Ñ–æ–Ω–∞—Ä–∏–∫–æ–º.",
        task: "–ù–∞–π–¥–∏—Ç–µ 5 —Å–ø—Ä—è—Ç–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –Ω–æ—á—å—é",
        hint: "–ö–æ–¥: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤",
        fact: "–ú–Ω–æ–≥–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ –≤–∏–¥—è—Ç –≤ —Ç–µ–º–Ω–æ—Ç–µ –≤ 6 —Ä–∞–∑ –ª—É—á—à–µ —á–µ–ª–æ–≤–µ–∫–∞!",
        answer: "5",
        points: 550
    },
    11: {
        title: "üß™ –≠–¢–ê–ü 11: –õ–ê–ë–û–†–ê–¢–û–†–ò–Ø",
        description: "–ü—Ä–æ–±–µ—Ä–∏—Ç–µ—Å—å –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é –ê–≥—Ä–∏—É—Å–∞! –°–æ–∑–¥–∞–π—Ç–µ –∞–Ω—Ç–∏–¥–æ—Ç.",
        task: "–°–º–µ—à–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã",
        hint: "–ö–æ–¥: —Ñ–æ—Ä–º—É–ª–∞ –∞–Ω—Ç–∏–¥–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: A+B+C)",
        fact: "–ü–µ—Ä–≤—ã–π –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫ –±—ã–ª –æ—Ç–∫—Ä—ã—Ç –≤ 1928 –≥–æ–¥—É!",
        answer: "–ó–ï–õ–ï–ù–¨+–ö–†–ê–°–ù–´–ô+–°–ò–ù–ò–ô",
        points: 600
    },
    12: {
        title: "üé≠ –≠–¢–ê–ü 12: –ú–ê–°–ö–ê–†–ê–î",
        description: "–ê–≥—Ä–∏—É—Å —Å–ø—Ä—è—Ç–∞–ª—Å—è —Å—Ä–µ–¥–∏ –∑–æ–º–±–∏! –ù–∞–π–¥–∏—Ç–µ –µ–≥–æ –ø–æ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º.",
        task: "–ù–∞–π–¥–∏—Ç–µ –æ—Ç–ª–∏—á–∏—è —É –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –ê–≥—Ä–∏—É—Å–∞",
        hint: "–ö–æ–¥: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ª–∏—á–∏–π",
        fact: "–ò—Å–∫—É—Å—Å—Ç–≤–æ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç—ã—Å—è—á–∏ –ª–µ—Ç!",
        answer: "3",
        points: 650
    },
    13: {
        title: "üèÜ –≠–¢–ê–ü 13: –§–ò–ù–ê–õ–¨–ù–ê–Ø –ë–ò–¢–í–ê",
        description: "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–æ—Ç–∏–≤–æ—Å—Ç–æ—è–Ω–∏–µ —Å –ê–≥—Ä–∏—É—Å–æ–º! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω—Ç–∏–¥–æ—Ç.",
        task: "–í–≤–µ–¥–∏—Ç–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è —Å–ø–∞—Å–µ–Ω–∏—è —Ñ–µ—Ä–º—ã",
        hint: "–ö–æ–¥: –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏–≤–æ—Ç–Ω—ã—Ö –Ω–∞ —Ñ–µ—Ä–º–µ",
        fact: "–§–µ—Ä–º–∞ —Å–ø–∞—Å–µ–Ω–∞! –í—ã —Å—Ç–∞–ª–∏ –≥–µ—Ä–æ–µ–º!",
        answer: "42",
        points: 1000
    }
};
function endGame() {
    stopGame();
    
    const stageContent = document.getElementById('stage-content');
    const totalStages = Object.keys(stages).length;
    const completedStages = gameState.currentStage - 1;
    const completionPercent = Math.round((completedStages / totalStages) * 100);
    
    let title, message;
    if (completedStages === totalStages) {
        title = "üéâ –ü–û–ë–ï–î–ê!";
        message = "–í—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–ø–∞—Å–ª–∏ —Ñ–µ—Ä–º—É –æ—Ç –∑–æ–º–±–∏-–≤–∏—Ä—É—Å–∞!";
    } else if (completedStages >= totalStages * 0.7) {
        title = "ü•à –û–¢–õ–ò–ß–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢!";
        message = "–í—ã —Å–ø–∞—Å–ª–∏ –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å —Ñ–µ—Ä–º—ã!";
    } else if (completedStages >= totalStages * 0.4) {
        title = "ü•â –•–û–†–û–®–ê–Ø –ü–û–ü–´–¢–ö–ê!";
        message = "–í—ã —Å–ø–∞—Å–ª–∏ —á–∞—Å—Ç—å –∂–∏–≤–æ—Ç–Ω—ã—Ö!";
    } else {
        title = "üí™ –ü–†–û–î–û–õ–ñ–ê–ô–¢–ï –ë–û–†–û–¢–¨–°–Ø!";
        message = "–§–µ—Ä–º–∞ –µ—â–µ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ –≤–∞—à–µ–π –ø–æ–º–æ—â–∏!";
    }
    
    stageContent.innerHTML = `
        <div class="game-complete">
            <h2>${title}</h2>
            <p>${message}</p>
            
            <div class="final-stats">
                <div class="stat-item">
                    <span>üéØ –ü—Ä–æ–π–¥–µ–Ω–æ —ç—Ç–∞–ø–æ–≤:</span>
                    <span>${completedStages}/${totalStages} (${completionPercent}%)</span>
                </div>
                <div class="stat-item">
                    <span>üèÜ –ù–∞–±—Ä–∞–Ω–æ –æ—á–∫–æ–≤:</span>
                    <span>${gameState.score}</span>
                </div>
                <div class="stat-item">
                    <span>‚≠ê –†–µ–π—Ç–∏–Ω–≥:</span>
                    <span>${getRating(gameState.score)}</span>
                </div>
            </div>
            
            <div class="progress-bar" style="margin: 20px 0;">
                <div class="progress-fill" style="width: ${completionPercent}%"></div>
            </div>
            
            <div class="results-buttons">
                <button onclick="startGame()" class="btn-primary">üîÑ –ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
                <button onclick="showMainMenu()" class="btn-secondary">üè† –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ</button>
                <button onclick="shareResults()" class="btn-secondary">üì§ –ü–û–î–ï–õ–ò–¢–¨–°–Ø</button>
            </div>
        </div>
    `;
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Telegram
    tg.sendData(JSON.stringify({
        action: 'game_complete',
        score: gameState.score,
        stages: completedStages,
        total_stages: totalStages,
        rating: getRating(gameState.score)
    }));
}

function getRating(score) {
    if (score >= 5000) return "üßô‚Äç‚ôÇÔ∏è –õ–ï–ì–ï–ù–î–ê –§–ï–†–ú–´";
    if (score >= 4000) return "üèÜ –ú–ê–°–¢–ï–† –°–ü–ê–°–ï–ù–ò–Ø";
    if (score >= 3000) return "‚≠ê –ì–ï–†–û–ô –§–ï–†–ú–´";
    if (score >= 2000) return "üëç –û–ü–´–¢–ù–´–ô –§–ï–†–ú–ï–†";
    if (score >= 1000) return "üå± –ù–ê–ß–ò–ù–ê–Æ–©–ò–ô";
    return "üéØ –ù–û–í–ò–ß–û–ö";
}

function shareResults() {
    const results = {
        score: gameState.score,
        stages: gameState.currentStage - 1,
        total: Object.keys(stages).length
    };
    
    const shareText = `–Ø –ø—Ä–æ—à–µ–ª(–∞) ${results.stages} –∏–∑ ${results.total} —ç—Ç–∞–ø–æ–≤ –≤ –∏–≥—Ä–µ "–ó–æ–º–±–∏-–§–µ—Ä–º–∞" –∏ –Ω–∞–±—Ä–∞–ª(–∞) ${results.score} –æ—á–∫–æ–≤! üßüüèÜ\n\n–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è: ${WEBAPP_URL}`;
    
    if (navigator.share) {
        navigator.share({
            title: '–ú–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ó–æ–º–±–∏-–§–µ—Ä–º–µ',
            text: shareText,
            url: WEBAPP_URL
        });
    } else {
        navigator.clipboard.writeText(shareText).then(() => {
            showMessage('üìã –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å –¥—Ä—É–∑—å—è–º–∏!', 'success');
        });
    }
}
